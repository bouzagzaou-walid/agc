<!DOCTYPE html>
<html>
<head>
	<title>WELCOME OUMAIMA</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
	<meta charset="utf-8">
</head>
<body>
	<header>
		<img src="images.png">
	</header>
	<h3>HELLO ADMIN</h3>
	<form method="post" action="">
		<table>
		<tr><td>
		<label>Matricule admin : </label></td><td><input type="email" id="email"></br></td></tr>
		<tr><td><label>password : </label></td><td><input type="password" id="MP"></br></td></tr>
		<tr><td><input type="submit" value="connect" id="submit"></td></tr>
		
	</form>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-firestore.js"></script>


<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyD8P74ee-htpMkrKaKrHuA6Or8l_Oc97s0",
    authDomain: "tms-agc.firebaseapp.com",
    databaseURL: "https://tms-agc.firebaseio.com",
    projectId: "tms-agc",
    storageBucket: "tms-agc.appspot.com",
    messagingSenderId: "1003552407947",
    appId: "1:1003552407947:web:a3378c7175e7175c7caf8e",
    measurementId: "G-WNLBJZWG49"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

function authentifier (){
  let email = document.getElementById("email").value;
  let MP = document.getElementById("MP").value;
  let auth = firebase.auth();
  firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION)
  .then(function() {
    // Existing and future Auth states are now persisted in the current
    // session only. Closing the window would clear any existing state even
    // if a user forgets to sign out.
    // ...
    // New sign-in will be persisted with session persistence.
    return auth.signInWithEmailAndPassword(email, MP)
  })
  .catch(function(error) {
    // Handle Errors here.
    var errorCode = error.code;
    var errorMessage = error.message;
  });

  auth.signInWithEmailAndPassword(email, MP)
  .then(function(){
        checkUser();
})
  .catch(function(){alert("input ERROR");});
}
function checkUser(){
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
  console.log(user);
  document.location.href="gerer.html";

  } else {
  console.log('out');
    
  }
});}
	document.getElementById("submit").addEventListener("click", function (event) {
        event.preventDefault();
        authentifier();

    } )
 

  </script>
</body>
</html>
